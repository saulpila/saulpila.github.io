<!DOCTYPE html>
<html>
<body style="width: 100%;">
<div style="width: 80%; margin: auto;margin-top: calc(50vh - 15px);">

<input type="text" id="textinput" placeholder="URL o DOI" style="width: calc(100% - 55px);font-size:18pt">
<button id="myBtn" onclick="submit()" style="width: 40px;font-size:18pt">Ir</button>

</div>
<script>
var input = document.getElementById("textinput");
function validURL(str) {
  var pattern = new RegExp('^(https?:\\/\\/)?'+ // protocol
    '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|'+ // domain name
    '((\\d{1,3}\\.){3}\\d{1,3}))'+ // OR ip (v4) address
    '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*'+ // port and path
    '(\\?[;&a-z\\d%_.~+=-]*)?'+ // query string
    '(\\#[-a-z\\d_]*)?$','i'); // fragment locator
  return !!pattern.test(str);
}
input.addEventListener("keyup", function(event) {
  if (event.keyCode === 13) {
   event.preventDefault();
   document.getElementById("myBtn").click();
  }
});
var getParams = function (url) {
	var params = {};
	var parser = document.createElement('a');
	parser.href = url;
	var query = parser.search.substring(1);
	var vars = query.split('&');
	for (var i = 0; i < vars.length; i++) {
		var pair = vars[i].split('=');
		params[pair[0]] = decodeURIComponent(pair[1]);
	}
	return params;
};
prms=getParams(window.location.href);
v=prms.u;
if(v!==undefined){
   submit(v)
}

function submit(v){
if(v===undefined){v=input.value}
 
  if(validURL(v)){
    var url = new URL(v);
    newhost=url.hostname.replaceAll(".","-")+".pbidi.unam.mx:2443"
    newurl="https://"+newhost+url.pathname+url.search
    window.location.href =newurl
  }
  else{
    submit("https://doi.org/"+v)
  }
}
</script>
</body>
</html>
